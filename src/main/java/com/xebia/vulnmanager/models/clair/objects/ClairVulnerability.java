package com.xebia.vulnmanager.models.clair.objects;

import com.fasterxml.jackson.annotation.JsonBackReference;
import com.fasterxml.jackson.annotation.JsonProperty;
import com.xebia.vulnmanager.models.generic.GenericResult;
import com.xebia.vulnmanager.util.ReportType;

import javax.persistence.*;
import java.io.Serializable;

@Table(name = "ClairVulnerability")
@Entity
public class ClairVulnerability implements Serializable {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private Long id;

    @ManyToOne
    @JoinColumn(name = "clair_report_id", nullable = false) // Column that will be used to keep track of the parent
    @JsonBackReference // A backrefrence to keep json from infinite looping
    private ClairReport clairReport;

    @JsonProperty("featurename")
    private String featureName;
    @JsonProperty("featureversion")
    private String featureVersion;
    @JsonProperty("vulnerability")
    private String vulnerability;
    @JsonProperty("namespace")
    private String namespace;
    // Specify columnDefinition to text to store text with more then 255 chars
    @Column(columnDefinition = "text")
    @JsonProperty("description")
    private String description;
    @JsonProperty("link")
    private String link;
    @JsonProperty("severity")
    private String severity;
    @JsonProperty("fixedby")
    private String fixedBy;

    public ClairVulnerability() {
        // Empty constructor
    }

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public ClairReport getClairReport() {
        return clairReport;
    }

    public void setClairReport(ClairReport clairReport) {
        this.clairReport = clairReport;
    }

    public String getFeatureName() {
        return featureName;
    }

    public void setFeatureName(String featureName) {
        this.featureName = featureName;
    }

    public String getFeatureVersion() {
        return featureVersion;
    }

    public void setFeatureVersion(String featureVersion) {
        this.featureVersion = featureVersion;
    }

    public String getVulnerability() {
        return vulnerability;
    }

    public void setVulnerability(String vulnerability) {
        this.vulnerability = vulnerability;
    }

    public String getNamespace() {
        return namespace;
    }

    public void setNamespace(String namespace) {
        this.namespace = namespace;
    }

    public String getDescription() {
        return description;
    }

    public void setDescription(String description) {
        this.description = description;
    }

    public String getLink() {
        return link;
    }

    public void setLink(String link) {
        this.link = link;
    }

    public String getSeverity() {
        return severity;
    }

    public void setSeverity(String severity) {
        this.severity = severity;
    }

    public String getFixedBy() {
        return fixedBy;
    }

    public void setFixedBy(String fixedBy) {
        this.fixedBy = fixedBy;
    }

    public GenericResult getGenericResult() {
        GenericResult result = new GenericResult();
        result.setType(ReportType.CLAIR);
        result.setCve(getVulnerability());
        result.setDescription(description);
        result.setThread(getSeverity());
        result.setName(getFeatureName());
        result.setKnownSolution(getFixedBy());
        result.setId(getId());
        return result;
    }
}
